@page "/auditlogviewer"
@using RPK_BlazorApp.Models
@using RPK_BlazorApp.Components.Shared
@using RPK_BlazorApp.Models.DataGrid
@using RPK_BlazorApp.Models.UI

<PageTitle>Audit Log Viewer</PageTitle>

<h1>Audit Log Viewer</h1>

<div class="filter-controls">
    <button class="btn btn-primary" @onclick="ToggleQueryBuilder">Advanced Filter</button>
</div>

<FloatingQueryBuilder TItem="AuditLog"
                      @bind-Visible="_isQueryBuilderVisible"
                      AvailableColumns="_queryBuilderColumns"
                      OnApply="HandleQueryApplied"
                      OnClear="HandleQueryClear"
                      OnSave="HandleSaveQuery"
                      OnDelete="HandleDeleteQuery"
                      SavedQueries="_savedQueries" />

<GenericDataView @ref="_dataView" TItem="AuditLog"
                 DataProvider="@((DataRequestBase request) => LoadAuditLogData(request))"
                 ColumnDefinitions="@columnDefinitions"
                 ExportFunction="@ExportAuditLogsToExcel"
                 ExportFileName="AuditLogs"
                 ShowCheckboxes="true"
                 @bind-SelectedItems="_selectedLogs">
    <ActionColumnTemplate>
        <FluentButton IconStart="@(new Icons.Regular.Size20.Search())" Title="View Details" OnClick="@(() => ViewLogDetails(context.Id))" />
    </ActionColumnTemplate>
</GenericDataView>