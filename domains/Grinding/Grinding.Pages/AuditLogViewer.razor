@page "/auditlogviewer"
@using DataHub.Core.Models
@using DataHub.Core.Components.Shared
@using DataHub.Core.Models.DataGrid
@using DataHub.Core.Models.UI

<PageTitle>Audit Log Viewer</PageTitle>

<h1>Audit Log Viewer</h1>

<div class="filter-controls">
    <button class="btn btn-primary" @onclick="ToggleQueryBuilder">Advanced Filter</button>
</div>

<FloatingQueryBuilder TItem="AuditLog"
                      @bind-Visible="_isQueryBuilderVisible"
                      AvailableColumns="_queryBuilderColumns"
                      OnApply="HandleQueryApplied"
                      OnClear="HandleQueryClear"
                      OnSave="HandleSaveQuery"
                      OnDelete="HandleDeleteQuery"
                      SavedQueries="_savedQueries" />

<GenericDataView @ref="_dataView" TItem="AuditLog"
                 DataProvider="@((DataRequestBase request) => LoadAuditLogData(request))"
                 ColumnDefinitions="@columnDefinitions"
                 ExportFunction="@ExportAuditLogsToExcel"
                 ExportFileName="AuditLogs"
                 ShowCheckboxes="true"
                 SelectedItems="_selectedLogs"
                 SelectedItemsChanged="@((HashSet<AuditLog> items) => _selectedLogs = items)">
    <ActionColumnTemplate>
        <FluentButton IconStart="@(new Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20.Info())" Title="View Details" OnClick="@(() => ViewLogDetails(context.Id))" />
    </ActionColumnTemplate>
</GenericDataView>